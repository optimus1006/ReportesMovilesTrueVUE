stores: "(SELECT hierarchy_id AS id, name AS title, hierarchy_type_id AS type, parent_hierarchy_id AS parent FROM org_hierarchy UNION ALL SELECT s.store_id * -1 AS id, s.name AS title , oht.hierarchy_type_id AS type, s.hierarchy_id AS parent FROM store AS s CROSS JOIN org_hierarchy_type AS oht WHERE oht.name = 'Site') Order by parent_hierarchy_id desc "
report1: "SELECT oh.hierarchy_id AS PARENTHIERARCHYID, oh.name AS PARENTHIERARCHYNAME, oht.name AS PARENTHIERARCHYTYPE, s.store_id * -1 AS HIERARCHYID, s.name AS HIERARCHYNAME, s.store_id AS VUEHIERARCHYID, COALESCE(s.site_code, ' ') AS SITECODE, CAST(CONVERT(CHAR(10),fct.timestamp_local,121) AS DATETIME) AS HIERARCHYDATADATE, DATENAME(dw,fct.timestamp_local) AS HIERARCHYDATADAY,fct.sales_trans_count_daily AS HIERARCHYTRANSACTIONDATECOUNT, fct.sales_trans_dollars_daily AS HIERARCHYSALESDATETOTAL, fct.sales_unit_count_daily AS HIERARCHYITEMDATECOUNT, fct.people_count_daily AS HIERARCHYPEOPLEDATECOUNT, ( CASE WHEN fct.people_count_daily = 0 THEN NULL ELSE fct.sales_trans_count_daily / CAST(fct.people_count_daily AS FLOAT) * 100 END ) AS HIERARCHYCONVERSIONDATERATE, ( CASE WHEN fct.sales_trans_count_daily = 0 THEN NULL ELSE fct.sales_trans_dollars_daily / CAST(fct.sales_trans_count_daily AS FLOAT) END ) AS HIERARCHYAVERAGEDATESALES, ( CASE WHEN fct.sales_trans_count_daily = 0 THEN NULL ELSE fct.sales_unit_count_daily / CAST(fct.sales_trans_count_daily AS FLOAT) END ) AS HIERARCHYAVERAGEDATEUNITS FROM store s INNER JOIN org_hierarchy oh ON oh.hierarchy_id = s.hierarchy_id INNER JOIN org_hierarchy_type oht ON oh.hierarchy_type_id = oht.hierarchy_type_id INNER JOIN ( SELECT COALESCE(tmp1.store_id,tmp2.store_id) AS store_id, COALESCE(tmp1.timestamp_local,tmp2.timestamp_local) AS timestamp_local, tmp1.sales_trans_count_daily, tmp1.sales_trans_dollars_daily, tmp1.sales_unit_count_daily, tmp1.sales_trans_count_hourly, tmp1.sales_trans_dollars_hourly, tmp1.sales_unit_count_hourly, tmp2.people_count_daily, tmp2.people_count_hourly FROM ( SELECT tmp3.store_id, tmp4.timestamp_local AS timestamp_local, tmp3.sales_trans_count AS sales_trans_count_daily, tmp3.sales_trans_dollars AS sales_trans_dollars_daily, tmp3.sales_unit_count AS sales_unit_count_daily, tmp4.sales_trans_count AS sales_trans_count_hourly, tmp4.sales_trans_dollars AS sales_trans_dollars_hourly, tmp4.sales_unit_count AS sales_unit_count_hourly FROM ( SELECT s.store_id, CAST(CONVERT(CHAR(10),dmh.timestamp_local,121) AS DATETIME) AS timestamp_local, SUM(dmh.sales_trans_count) AS sales_trans_count, SUM(dmh.sales_trans_dollars) AS sales_trans_dollars, SUM(dmh.sales_unit_count) AS sales_unit_count FROM store AS s INNER JOIN es_store_map AS esm ON s.store_id = esm.store_id INNER JOIN es_sales_hist AS dmh ON dmh.es_division_id = esm.es_division_id AND dmh.es_store_id = esm.es_store_id WHERE s.deleted = 0 AND dmh.within_store_hours = 1  and dmh.timestamp_local >= convert(datetime, '%_DATE_%', 121)  and dmh.timestamp_local <= convert(datetime, '%_DATE_END_%', 121)   and s.store_id in (%_STORES_%) GROUP BY s.store_id, CAST(CONVERT(CHAR(10),dmh.timestamp_local,121) AS DATETIME) ) AS tmp3 INNER JOIN ( SELECT s.store_id, CAST(CONVERT(CHAR(10),CAST(CONVERT(CHAR(13),dmh.timestamp_local,121) + ':00:00' AS DATETIME),121) AS DATETIME) AS timestamp_local_daily, CAST(CONVERT(CHAR(13),dmh.timestamp_local,121) + ':00:00' AS DATETIME) AS timestamp_local, SUM(dmh.sales_trans_count) AS sales_trans_count, SUM(dmh.sales_trans_dollars) AS sales_trans_dollars, SUM(dmh.sales_unit_count) AS sales_unit_count FROM store AS s INNER JOIN es_store_map AS esm ON s.store_id = esm.store_id INNER JOIN es_sales_hist AS dmh ON dmh.es_division_id = esm.es_division_id AND dmh.es_store_id = esm.es_store_id WHERE s.deleted = 0 AND dmh.within_store_hours = 1  and dmh.timestamp_local >= convert(datetime, '%_DATE_%', 121)  and dmh.timestamp_local <= convert(datetime, '%_DATE_END_%', 121)   and s.store_id in (%_STORES_%) GROUP BY s.store_id, CAST(CONVERT(CHAR(13),dmh.timestamp_local,121) + ':00:00' AS DATETIME) ) AS tmp4 ON tmp3.store_id = tmp4.store_id AND tmp3.timestamp_local = tmp4.timestamp_local_daily ) AS tmp1 FULL OUTER JOIN ( SELECT tmp5.store_id, tmp6.timestamp_local AS timestamp_local, tmp5.people_count AS people_count_daily, tmp6.people_count AS people_count_hourly FROM ( SELECT s.store_id, CAST(CONVERT(CHAR(10),dmh.timestamp_local,121) AS DATETIME) AS timestamp_local, SUM(dmh.measure) AS people_count FROM store AS s INNER JOIN es_store_map AS esm ON s.store_id = esm.store_id INNER JOIN es_device_instance_hist AS dih ON dih.es_division_id = esm.es_division_id AND dih.es_store_id = esm.es_store_id INNER JOIN es_device_measure_hist AS dmh ON dmh.device_instance_hist_id = dih.device_instance_hist_id WHERE dih.es_device_type = 'People_Count' AND dmh.tag_id = 3 AND s.deleted = 0 AND dmh.within_store_hours = 1  and dmh.timestamp_local >= convert(datetime, '%_DATE_%', 121)  and dmh.timestamp_local <= convert(datetime, '%_DATE_END_%', 121)   and s.store_id in (%_STORES_%) GROUP BY s.store_id, CAST(CONVERT(CHAR(10),dmh.timestamp_local,121) AS DATETIME) ) AS tmp5 INNER JOIN ( SELECT s.store_id, CAST(CONVERT(CHAR(10),CAST(CONVERT(CHAR(13),dmh.timestamp_local,121) + ':00:00' AS DATETIME),121) AS DATETIME) AS timestamp_local_daily, CAST(CONVERT(CHAR(13),dmh.timestamp_local,121) + ':00:00' AS DATETIME) AS timestamp_local, SUM(dmh.measure) AS people_count FROM store AS s INNER JOIN es_store_map AS esm ON s.store_id = esm.store_id INNER JOIN es_device_instance_hist AS dih ON dih.es_division_id = esm.es_division_id AND dih.es_store_id = esm.es_store_id INNER JOIN es_device_measure_hist AS dmh ON dmh.device_instance_hist_id = dih.device_instance_hist_id WHERE dih.es_device_type = 'People_Count' AND dmh.tag_id = 3 AND s.deleted = 0 AND dmh.within_store_hours = 1  and dmh.timestamp_local >= convert(datetime, '%_DATE_%', 121)  and dmh.timestamp_local <= convert(datetime, '%_DATE_END_%', 121)   and s.store_id in (%_STORES_%) GROUP BY s.store_id, CAST(CONVERT(CHAR(13),dmh.timestamp_local,121) + ':00:00' AS DATETIME) ) AS tmp6 ON tmp5.store_id = tmp6.store_id AND tmp5.timestamp_local = tmp6.timestamp_local_daily ) AS tmp2 ON tmp1.store_id = tmp2.store_id AND tmp1.timestamp_local = tmp2.timestamp_local ) AS fct ON fct.store_id = s.store_id "
report1_colums: "PARENTHIERARCHYNAME,HIERARCHYNAME,HIERARCHYDATADATE,HIERARCHYDATADAY,HIERARCHYTRANSACTIONDATECOUNT,HIERARCHYSALESDATETOTAL,HIERARCHYITEMDATECOUNT,HIERARCHYPEOPLEDATECOUNT,HIERARCHYCONVERSIONDATERATE,HIERARCHYAVERAGEDATESALES,HIERARCHYAVERAGEDATEUNITS"
report1_order_by: "order by %_COLUMS_% "
query: "SELECT  ROW_NUMBER() OVER (ORDER BY PARENTHIERARCHYNAME) AS RowNum, %_COLUMS_% FROM (%_QUERY_%) AS DerivedTableQuery GROUP BY %_COLUMS_% "
pagination: "SELECT * FROM (%_QUERY_%) AS DerivedTablePagination WHERE DerivedTablePagination.RowNum BETWEEN %_startRow_% AND %_endRow_% "
rows: 2